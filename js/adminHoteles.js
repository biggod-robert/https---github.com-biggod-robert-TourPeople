$(document).ready(function(){var e=0,t=1,a=[];tabla_hoteles=$("#tabla_hoteles").DataTable({ajax:{url:"../controller/adminHoteles.php",method:"POST",data:{opcion:t},dataSrc:""},columns:[{data:"id_hotel"},{data:"nombre"},{defaultContent:"<div class='multi-button mx-auto'><button><i class='fas fa-trash deleteEvento'></i></button><button><i class='fa-regular fa-pen-to-square editHotel'></i></button></div>",className:"align-middle text-center text-sm td-respon"},],order:[[0,"desc"]],responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,type:"none",target:""}}}),$(".addHotel").click(function(e){e.preventDefault(),t=2,o(),$("#titulo-modal").text("Nuevo Hotel"),$("#imgPortada").attr("required",!0),$("#modalHotel").modal("show")}),$("#imgPortada").on("change",function(){let e=this.files[0];if(e){let t=new FileReader;t.onload=function(e){$(".previewImgPortada").empty();let t=$("<img>").attr("src",e.target.result);$(".previewImgPortada").append(t)},t.readAsDataURL(e)}}),$(".cap-img").click(function(){if(e<6){var t=$("<input>").attr({type:"file",accept:"image/*",name:"imagen[]",id:"imgUploas"+e,multiple:!0}).css("display","none");$("#formHoteles").append(t),t.change(function(){var t=this.files,r=t.length;if(e+r>6)alert("Solo se permiten hasta 6 im\xe1genes.");else for(var o=0;o<r;o++){var i=t[o];a.push(i);var n=new FileReader;n.onload=function(t){var a=t.target.result,r=$("<img>").attr({src:a,class:"img-thumbnail imgEvide"}),o=$("<i>").addClass("fas fa-trash-alt detelete-img-upload btnDelete").attr("data-index",e),i=$("<div>").addClass("contImgUP").append(r,o),n=$("<div>").addClass("col-md-4 d-flex").append(i);$("#cont-previu").append(n),e++,$(".cap-img").attr("imgCapturadas",e),$(".previewEvide").removeClass("igmError"),$(".cap-img").removeClass("igmErrorCap"),$(".imgEvide").click(function(){var e=$(this).attr("src");$("#imgFullViewSRC").attr("src",e),$(".viewFullImg").removeClass("esconder")}),$(".c-full-view").click(function(){$(".viewFullImg").addClass("esconder")})},n.readAsDataURL(i)}}),t.click()}else alert("No se pueden agregar m\xe1s de 6 im\xe1genes.")}),$("#cont-previu").on("click",".detelete-img-upload",function(){var t,r,o=$(this).attr("data-index");a.splice(o,1),$(this).closest(".col-md-4").remove(),e--,$(".cap-img").attr("imgCapturadas",e),$('input[type="file"][name="imagen[]"]').remove(),t=$("<input>").attr({type:"file",accept:"image/*",name:"imagen[]",multiple:!0}).css("display","none"),$("#formHoteles").append(t),r=new DataTransfer,a.forEach(function(e){r.items.add(e)}),t[0].files=r.files});let r=new Quill("#editorDescripcion",{modules:{syntax:!0,toolbar:"#toolbar-container"},placeholder:"Escribe la descripcion de tu sitio",theme:"snow"});function o(){$("#formHoteles")[0].reset(),$(".previewImgPortada").empty(),$("#cont-previu").empty(),a=[],e=0,r.setContents([]),$("#imgPortada").attr("required",!0)}$("#formHoteles").submit(function(a){if(a.preventDefault(),0==e){$(".cap-img").addClass("igmErrorCap"),$(".previewEvide").addClass("igmErrorCap"),setTimeout(()=>{$(".cap-img").removeClass("igmErrorCap"),$(".previewEvide").removeClass("igmErrorCap")},3500),Swal.fire({title:"Advertencia",text:"Debes de seleccionar de 1 a 6 im\xe1genes",icon:"warning"});return}if(0===r.getText().trim().length){$("#editorDescripcion").addClass("igmErrorCap"),Swal.fire({title:"Advertencia",text:"La descripci\xf3n de la sitio es obligatoria",icon:"warning"}),setTimeout(()=>{$("#editorDescripcion").removeClass("igmErrorCap")},3500);return}let o=document.getElementById("formHoteles"),i=new FormData(o),n=r.getContents();i.append("opcion",t),i.append("descripcion",JSON.stringify(n)),$.ajax({type:"POST",url:"../controller/adminHoteles.php",data:i,cache:!1,contentType:!1,processData:!1,beforeSend:function(){$("#loader").removeClass("esconder"),$("body").addClass("hidenn")},success:function(e){console.log(e);var t=JSON.parse(e);tabla_hoteles.ajax.reload(),$("#modalHotel").modal("hide"),$("#loader").addClass("esconder"),$("body").removeClass("hidenn"),1==t.codigo?Swal.fire({icon:"success",title:"EXITO",html:t.mensaje}):Swal.fire({icon:"error",title:"Ooops.",html:t.mensaje})}})}),$(".c-full-view").click(function(){$(".viewFullImg").addClass("esconder")}),$(document).on("click",".editHotel",function(i){i.preventDefault();var n=$(this).closest("tr");n.hasClass("child")&&(n=n.prev());var s=tabla_hoteles.row(n).data().id_hotel;t=3,$("#titulo-modal").text("Editar Sitio"),o(),$("#imgPortada").removeAttr("required"),$.ajax({type:"POST",url:"../controller/adminHoteles.php",data:{opcion:t,idHotel:s},beforeSend:function(){$("#loader").removeClass("esconder"),$("body").addClass("hidenn")},success:function(o){console.log(o);try{var i=JSON.parse(o);if(1===i.codigo&&i.data){var n=i.data;$("#id_hotelEdit").val(n.id_hotel),$("#nombreHotel").val(n.nombre),$("#direccion").val(n.ubi_hotel),$("#enlace_reservas").val(n.enlace_reservas_turs),r.setContents(JSON.parse(n.descripcion));var s="../upload/hoteles/portadas/"+n.imgPortada;$(".previewImgPortada").html('<img src="'+s+'" class="img-thumbnail">'),n.imagenes.forEach(function(t,r){var o=`
                            <div class="col-md-4 d-flex">
                                <div class="contImgUP">
                                    <img src="${"../upload/hoteles/images/"+t.img}" class="img-thumbnail imgEvide">
                                    <i class="fas fa-trash-alt deteleteimgDB btnDelete" data-id="${t.id_img}"></i>
                                </div>
                            </div>`;$("#cont-previu").append(o),e++,a.push(t.img)}),t=5,$("#loader").addClass("esconder"),$("body").removeClass("hidenn")}}catch(l){console.error("Error al decodificar JSON: ",l,o)}}}),$("#modalHotel").modal("show")}),$("#cont-previu").on("click",".deteleteimgDB",function(){var e=$(this).attr("data-id"),t=$(this);$.ajax({type:"POST",url:"../controller/adminHoteles.php",data:{opcion:4,idImagen:e},beforeSend:function(){$("#loader").removeClass("esconder"),$("body").addClass("hidenn")},success:function(e){try{var a=JSON.parse(e);1===a.codigo?(t.closest(".col-md-4").remove(),Swal.fire({icon:"success",title:"EXITO",text:a.mensaje})):Swal.fire({icon:"error",title:"Error",text:a.mensaje})}catch(r){console.error("Error al decodificar JSON: ",r,e),Swal.fire({icon:"error",title:"Error",text:"Error en la respuesta del servidor."})}$("#loader").addClass("esconder"),$("body").removeClass("hidenn")},error:function(e,t,a){console.error("Error en la petici\xf3n AJAX: ",a),Swal.fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al intentar eliminar la imagen."}),$("#loader").addClass("esconder"),$("body").removeClass("hidenn")}})}),$(document).on("click",".deleteEvento",function(e){e.preventDefault();var t=$(this).closest("tr");t.hasClass("child")&&(t=t.prev());var a=tabla_hoteles.row(t).data().id_hotel;Swal.fire({title:"\xbfEst\xe1s seguro?",text:"\xa1Este hotel se eliminar\xe1 permanentemente!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&$.ajax({type:"POST",url:"../controller/adminHoteles.php",data:{opcion:6,idHotelDelete:a},beforeSend:function(){$("#loader").removeClass("esconder"),$("body").addClass("hidenn")},success:function(e){$("#loader").addClass("esconder"),$("body").removeClass("hidenn");var a=JSON.parse(e);1===a.codigo?(tabla_hoteles.row(t).remove().draw(),Swal.fire({icon:"success",title:"\xc9xito",text:a.mensaje})):Swal.fire({icon:"error",title:"Error",text:a.mensaje})},error:function(e,t,a){$("#loader").addClass("esconder"),$("body").removeClass("hidenn"),Swal.fire({icon:"error",title:"Error",text:"Error en la solicitud: "+t+" - "+a})}})})})});