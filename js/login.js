$(document).ready(function(){let e=0,t=!1,o;function a(){let e=Math.random().toString(36).substring(2,8).toUpperCase(),t=document.getElementById("captchaCanvas"),o=t.getContext("2d");o.clearRect(0,0,t.width,t.height),o.font="40px Arial",o.fillStyle="#000";let a=o.measureText(e).width,r=(t.width-a)/2,i=(t.height+20)/2;o.fillText(e,r,i);for(let n=0;n<5;n++)o.beginPath(),o.moveTo(Math.random()*t.width,Math.random()*t.height),o.lineTo(Math.random()*t.width,Math.random()*t.height),o.strokeStyle="#"+Math.floor(16777215*Math.random()).toString(16),o.stroke();t.setAttribute("data-captcha",e)}a(),$("#reloadCaptcha").click(function(){a()}),$("#correo, #pass, #captchaInput").on("input",function(){$(this).get(0).setCustomValidity("")}),$("#login_user").on("submit",function(r){if(r.preventDefault(),t){Swal.fire({icon:"error",title:"Bloqueado",text:"Has realizado 3 intentos fallidos. Intenta de nuevo m\xe1s tarde."});return}let i=$("#correo").val().trim(),n=$("#pass").val().trim(),s=$("#captchaInput").val().trim(),l=$("#captchaCanvas").attr("data-captcha");if(""===i){$("#correo").get(0).setCustomValidity("El campo de correo no puede estar vac\xedo."),$("#correo")[0].reportValidity();return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){$("#correo").get(0).setCustomValidity("Por favor, ingrese un correo electr\xf3nico v\xe1lido."),$("#correo")[0].reportValidity();return}if(""===n){$("#pass").get(0).setCustomValidity("La contrase\xf1a no puede estar vac\xeda."),$("#pass")[0].reportValidity();return}if(""===s||s!==l){if($("#captchaInput").get(0).setCustomValidity("El CAPTCHA ingresado es incorrecto."),a(),$("#captchaInput")[0].reportValidity(),++e>=3){t=!0,$("#loginBtn").prop("disabled",!0);let c=60;$("#loginBtn").text(`Bloqueado. Intenta de nuevo en ${c} segundos`),Swal.fire({icon:"error",title:"Bloqueado",text:"Has realizado 3 intentos fallidos de capchat. espera 1 minuto antes de volverlo a intentar."}),o=setInterval(function(){c--,$("#loginBtn").text(`Bloqueado ${c}s`),c<=0&&(clearInterval(o),t=!1,e=0,$("#loginBtn").prop("disabled",!1),$("#loginBtn").text("Iniciar sesi\xf3n"),a())},1e3)}return}var d=new FormData(document.getElementById("login_user"));$.ajax({type:"POST",url:"../controller/login.php",data:d,cache:!1,contentType:!1,processData:!1,beforeSend:function(){$("#loader_app").removeClass("esconder"),$("body").addClass("hidenn")},success:function(e){switch(e){case"0101a":window.location.href="../dashboard/";break;case"0101u":window.location.href="../inicio-usuarios/";break;case"0102w":$("#loader_app").addClass("esconder"),$("body").removeClass("hidenn"),Swal.fire({icon:"error",title:"Oops...",text:"La contrase\xf1a es incorrecta"});break;case"0103r":$("#loader_app").addClass("esconder"),$("body").removeClass("hidenn"),Swal.fire({icon:"error",title:"Oops...",text:"El usuario no existe"});break;case"0104b":$("#loader_app").addClass("esconder"),$("body").removeClass("hidenn"),Swal.fire({icon:"error",title:"Oops...",text:"Realizaste 3 intentos fallidos, se realiz\xf3 un bloqueo por 1 minuto"})}}})}),$(".registro").click(function(e){e.preventDefault(),window.location.href="../registro/"})});